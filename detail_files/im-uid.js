!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("IMUID",[],e):"object"==typeof exports?exports.IMUID=e():t.IMUID=e()}(this,(function(){return function(){var t={903:function(t,e){!function(){"use strict";var t={};!function(){var e=t;Object.defineProperty(e,"__esModule",{value:!0}),e.imUlid=void 0;var o="0123456789ABCDEFGHJKMNPQRSTVWXYZ";e.imUlid=function(){for(var t,e=Date.now(),i="",n=10;n--;)i=o[t=e%32]+i,e=(e-t)/32;n=16;var r=new Uint8Array(n);("crypto"in window?crypto:msCrypto).getRandomValues(r);for(;n--;)i+=o[31&r[n]];return i}}();var o=e;for(var i in t)o[i]=t[i];t.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})}()}},e={};function o(i){var n=e[i];if(n!==undefined)return n.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,o),r.exports}o.d=function(t,e){for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};var i={};return function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function n(t){var o=function(t,o){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,o||"default");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(t)}(t,"string");return"symbol"==e(o)?o:String(o)}function r(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,n(i.key),i)}}function u(t,e,o){return e&&r(t.prototype,e),o&&r(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e,o){return(e=n(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}o.d(i,{IMUID:function(){return R}});var c=o(903);function s(t){for(var e=t+"=",o=e.length,i=document.cookie.split("; "),n=0,r=i.length,u=void 0;n<r;n++)if((u=i[n]).substr(0,o)===e)return u.slice(o);return null}function d(t,e,o){void 0===o&&(o={});var i=o.path,n=o.domain,r=o.maxAge,u=o.expires,a=o.secure,c=o.sameSite,s=t+"="+e;i&&(s+=";path="+i),n&&(s+=";domain="+n),"number"==typeof r&&(s+=";max-age="+r),u&&(s+=";expires="+u.toUTCString()),a&&(s+=";secure"),c&&(s+=";samesite="+c),document.cookie=s}function f(t){return localStorage?localStorage.getItem(t):null}function p(t,e){try{localStorage.setItem(t,e)}catch(o){console.error(o)}}function l(t){localStorage&&localStorage.removeItem(t)}function v(t,e,o){return void 0===o&&(o={}),function(t,e,o){void 0===o&&(o={});var i=o.onError,n=o.onTimeout,r=o.timeout,u=o.withCredentials,a=new XMLHttpRequest;return a.onload=function(){e(a.responseText)},i&&(a.onerror=function(){i()}),n&&(a.ontimeout=function(){n()}),a.withCredentials=!!u,a.open("GET",t,!0),"number"==typeof r&&(a.timeout=r),a.send(),a}(t,(function(t){e(JSON.parse(t))}),o)}var m=function(t){return t.READY="ready",t.LOADING="loading",t.DONE="done",t.EXPIRED="expired",t.LOADING_IN_BACKGROUND="loadingInBackground",t}(m||{}),y="none",h="optout",b="https",D="timeout",I="_im_vid",g="_im_uid_expire",k="_im_uid_status",S="_im_uid",w=function(t){var e=location.hostname,o=location.protocol===b;!function(t,e){void 0===e&&(e={}),d(t,"",{maxAge:0,path:e.path,domain:e.domain,secure:e.secure,sameSite:e.sameSite})}(t,{domain:e,path:"/",secure:o,sameSite:o?y:"lax"})},E=function(){function e(){t(this,e),a(this,"processorMap",{})}return u(e,[{key:"run",value:function(t){"customerId"in t&&"callback"in t?this.processIMUIDRequest(t):"optout"in t&&this.processOptoutRequest(t)}},{key:"processIMUIDRequest",value:function(t){var e=t.customerId;e in this.processorMap||(this.processorMap[e]=new O({cid:e})),this.processorMap[e].processIMUIDRequest(t)}},{key:"processOptoutRequest",value:function(t){var o=t.optout,i=t.cookieDomain,n=t.setVisitor;o?e.setVid(h,i,n):e.vid===h&&(w(I),e.setVid((0,c.imUlid)(),i,n))}},{key:"get",value:function(t){var e;return(null===(e=this.processorMap[t])||void 0===e?void 0:e.uid)||""}}],[{key:"vid",get:function(){return s(I)}},{key:"setVid",value:function(t,e,o){!1!==o&&t&&function(t,e){var o,i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},n=i.cookieDomain,r=i.expireSeconds,u=n||location.hostname,a=location.protocol===b;r&&(o=new Date).setTime(o.getTime()+1e3*r),d(t,e,{domain:u,path:"/",secure:a,sameSite:a?y:"lax",expires:o})}(I,t,{cookieDomain:e,expireSeconds:3456e4})}}]),e}(),O=function(){function e(o){t(this,e),a(this,"cid",void 0),this.cid=o.cid}return u(e,[{key:"uidExpireTime",get:function(){var t=this.cid,e=f("".concat(g,".").concat(t));return"string"==typeof e?parseInt(e||"0"):null},set:function(t){var e=this.cid,o="".concat(g,".").concat(e);"number"==typeof t?p(o,t+""):l(o)}},{key:"uidLoadStatus",get:function(){var t=this.cid,e=f("".concat(k,".").concat(t));return null===e?m.READY:e},set:function(t){var e=this.cid;p("".concat(k,".").concat(e),t)}},{key:"uid",get:function(){var t=this.cid;return f("".concat(S,".").concat(t))},set:function(t){var e=this.cid,o="".concat(S,".").concat(e);t?p(o,t):l(o)}},{key:"processIMUIDRequest",value:function(t,e){var o=this;e||(e=Date.now());var i=t.callbackTimeout,n=void 0===i?1e3:i,r=t.callback,u=t.loopbacks,a=t.cookieDomain,s=t.setVisitor;E.vid?E.setVid(E.vid,a,s):E.setVid((0,c.imUlid)(),a,s);var d=E.vid,f=d===h;if(f)r({uid:"",vid:"",optouted:f,status:m.DONE,loopbacks:u});else{var p=this.uidExpireTime,l=this.cid,y=this.uidLoadStatus,b=Date.now();"number"==typeof p&&b>=p&&(y=m.EXPIRED);var I=t.SYNC_URL||"https://audiencedata.im-apps.net/imuid/get",g="&";switch(!1===t.setCidQuery?g="?":I+="?cid="+l,d&&(I+="".concat(g,"vid=")+d),y){default:case m.READY:this.uidLoadStatus=m.LOADING,this.uidExpireTime=b+18e5,v(I,(function(t){var e=t.uid;o.uid=e,o.uidLoadStatus=m.DONE,r({uid:e,vid:d,optouted:!1,status:m.DONE,loopbacks:u})}),{withCredentials:!0,timeout:n,onTimeout:function(){o.uidLoadStatus=m.READY,r({uid:"",vid:"",optouted:!1,status:D,loopbacks:u})}});break;case m.LOADING:if(b>=e+n)return this.uidLoadStatus=m.READY,void r({uid:"",vid:"",optouted:!1,status:D,loopbacks:u});setTimeout((function(){o.processIMUIDRequest(t,e)}),9);break;case m.DONE:r({uid:this.uid||"",vid:d,optouted:f,status:m.DONE,loopbacks:u});break;case m.EXPIRED:this.uidLoadStatus=m.LOADING_IN_BACKGROUND,this.uidExpireTime=b+18e5,v(I,(function(t){var e=t.uid;o.uid=e,o.uidLoadStatus=m.DONE}),{withCredentials:!0}),r({uid:this.uid||"",vid:d,optouted:!1,status:m.DONE,loopbacks:u});break;case m.LOADING_IN_BACKGROUND:r({uid:this.uid||"",vid:d,optouted:!1,status:m.DONE,loopbacks:u})}}}}]),e}(),x=window.IMUID;x||(x=new E);var N=window.IMUIDRequest;(N instanceof Array||!N)&&(window.IMUIDRequest={push:function(t){x.run(t)}}),N instanceof Array&&N.forEach((function(t){x.run(t)}));var R=x;window.IMUIDRequest}(),i=i.IMUID}()}));